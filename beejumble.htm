<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bee Jumble</title>
  <link rel="icon" href="bee.ico" type="image/x-icon" />
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #fff;
      color: #111;
      margin: 0;
      padding: 1.5em;
      line-height: 1.6;
      width: 100%;
    }

    .subtitle {
      text-align: center;
      font-size: 1em;
      margin-bottom: 1em;
    }

    table.header-table {
      width: 800px;
      margin: 0 auto;
      table-layout: fixed;
      border-spacing: 0;
    }

    table.header-table td {
      vertical-align: top;
    }

    table.header-table td:first-child,
    table.header-table td:last-child {
      width: 200px;
    }

    table.header-table td:first-child {
      text-align: right;
    }

    table.header-table td:last-child {
      text-align: left;
    }

    .nav-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
    }

    #dateSelector {
      font-size: 1em;
      padding: 0.3em;
      margin: 0;
    }

    #printBtn {
      font-size: 1em;
      padding: 0.3em 0.6em;
      cursor: pointer;
      margin: 0;
    }

    .honeycomb-row {
      width: 800px;
      margin: 1em auto;
      text-align: center;
    }

    .honeycomb {
      display: flex;
      gap: 10px;
      flex-wrap: nowrap;
      justify-content: center;
    }

    svg {
      display: block;
    }

    hr.separator {
      width: 800px;
      margin: 2em auto;
      border: 0;
      border-top: 1px solid #ccc;
    }

    .puzzle {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2em;
    }

    h4 {
      text-align: center;
      margin: 1em 0 0.25em;
      font-size: 1.1em;
      font-weight: normal;
    }

    .puzzle-columns {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
    }

    .puzzle-column {
      display: flex;
      flex-direction: column;
      padding-right: 1em;
      margin-right: 1em;
      border-right: 1px solid #ccc;
      flex: 1 1 calc(25% - 1em);
      max-width: calc(25% - 1em);
      box-sizing: border-box;
    }

    .puzzle-column:nth-child(4n) {
      border-right: none;
      margin-right: 0;
      padding-right: 0;
    }

    .word-row {
      display: flex;
      align-items: center;
      margin: 0.5em 0;
      flex-wrap: wrap;
    }

    .letter-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 4px;
    }

    .letter-label {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 4px;
    }

    .letter-box {
      width: 24px;
      height: 24px;
      border: 1px solid #aaa;
      text-align: center;
      line-height: 24px;
    }
  </style>
</head>
<body>
  <div class="subtitle" id="worksheetTitle">
    TheGameBureau.com presents the Bee Jumble Worksheet
  </div>

  <table class="header-table">
    <tr>
      <td>
        <div class="nav-controls">
          <button id="prevDayBtn">‚Üê</button>
          <select id="dateSelector"></select>
          <button id="nextDayBtn">‚Üí</button>
        </div>
      </td>
      <td></td>
      <td>
        <button id="printBtn" onclick="window.print()">üñ®Ô∏è Print</button>
      </td>
    </tr>
  </table>

  <div class="honeycomb-row">
    <div class="honeycomb" id="honeycomb"></div>
  </div>

  <hr class="separator" />

  <div class="puzzle" id="puzzle"></div>

  <script>
    function formatDate(date) {
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    }

    function formatWorksheetTitle(dateStr) {
      const date = new Date(dateStr);
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      return `TheGameBureau.com presents the Bee Jumble Worksheet for ${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
    }

    function createHexSVG(letter, count, isYellow = false) {
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", "60");
      svg.setAttribute("height", "52");
      svg.setAttribute("viewBox", "0 0 100 86");

      const polygon = document.createElementNS(svgNS, "polygon");
      polygon.setAttribute("points", "50,0 93,25 93,61 50,86 7,61 7,25");
      polygon.setAttribute("fill", isYellow ? "#f7da21" : "#e0e0e0");
      polygon.setAttribute("stroke", isYellow ? "#000" : "#999");
      polygon.setAttribute("stroke-width", isYellow ? "3" : "1");
      svg.appendChild(polygon);

      const text = document.createElementNS(svgNS, "text");
      text.setAttribute("x", "50%");
      text.setAttribute("y", "50%");
      text.setAttribute("text-anchor", "middle");
      text.setAttribute("font-family", "Georgia");
      text.setAttribute("font-size", "32");
      text.setAttribute("font-weight", "bold");
      text.setAttribute("fill", "#000");
      text.setAttribute("dominant-baseline", "middle");
      text.innerHTML = `${letter}<tspan dx="4" dy="0" font-size="22" alignment-baseline="middle">${count}</tspan>`;

      svg.appendChild(text);
      return svg;
    }

    function populateDateSelector() {
      const selector = document.getElementById("dateSelector");
      const startDate = new Date("2018-05-09");
      const today = new Date();
      for (let d = new Date(today); d >= startDate; d.setDate(d.getDate() - 1)) {
        const option = document.createElement("option");
        const dateStr = formatDate(d);
        option.value = dateStr;
        option.textContent = d.toDateString();
        selector.appendChild(option);
      }

      const urlDate = new URLSearchParams(window.location.search).get("date");
      const defaultDate = urlDate || formatDate(today);
      selector.value = defaultDate;
      loadPuzzle(defaultDate);
      document.getElementById("worksheetTitle").textContent = formatWorksheetTitle(defaultDate);
    }

    function loadPuzzle(dateStr) {
      fetch("jumbledbees.xml")
        .then(response => response.text())
        .then(xmlText => {
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(xmlText, "application/xml");
          const puzzles = xmlDoc.getElementsByTagName("puzzle");
          const puzzleDiv = document.getElementById("puzzle");
          const honeycomb = document.getElementById("honeycomb");
          puzzleDiv.innerHTML = '';
          honeycomb.innerHTML = '';

          for (let puzzle of puzzles) {
            if (puzzle.getAttribute("date") === dateStr) {
              const letters = puzzle.getAttribute("letters");
              const letterCounts = [];
              for (let i = 1; i <= letters.length; i++) {
                const tag = puzzle.getElementsByTagName(`letter${i}`)[0];
                letterCounts.push(tag ? tag.textContent : "0");
              }

              for (let i = 0; i < letters.length; i++) {
                const hexSVG = createHexSVG(letters[i], letterCounts[i], i === 0);
                honeycomb.appendChild(hexSVG);
              }
              break;
            }
          }
        });
    }

    document.getElementById("dateSelector").addEventListener("change", function () {
      const date = this.value;
      const newUrl = `${window.location.pathname}?date=${date}`;
      window.location.href = newUrl;
    });

    document.getElementById("prevDayBtn").addEventListener("click", () => {
      const selector = document.getElementById("dateSelector");
      const currentIndex = selector.selectedIndex;
      if (currentIndex < selector.options.length - 1) {
        const prevDate = selector.options[currentIndex + 1].value;
        window.location.href = `${window.location.pathname}?date=${prevDate}`;
      }
    });

    document.getElementById("nextDayBtn").addEventListener("click", () => {
      const selector = document.getElementById("dateSelector");
      const currentIndex = selector.selectedIndex;
      if (currentIndex > 0) {
        const nextDate = selector.options[currentIndex - 1].value;
        window.location.href = `${window.location.pathname}?date=${nextDate}`;
      }
    });

    populateDateSelector();
  </script>
</body>
</html>
